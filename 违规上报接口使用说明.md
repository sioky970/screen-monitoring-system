# è¿è§„ä¸ŠæŠ¥æ¥å£ä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¥å£æ¦‚è¿°

è¿è§„ä¸ŠæŠ¥æ¥å£ç”¨äºå®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¸ŠæŠ¥æ£€æµ‹åˆ°çš„è¿è§„è¡Œä¸ºï¼Œæ”¯æŒåŒæ—¶ä¸Šä¼ è¿è§„æˆªå›¾å’Œç›¸å…³ä¿¡æ¯ã€‚

## ğŸ”— æ¥å£ä¿¡æ¯

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£åœ°å€**: `POST /api/security/violations/report-with-screenshot`
- **æœåŠ¡å™¨åœ°å€**: `http://your-server:3001`
- **è®¤è¯æ–¹å¼**: æ— éœ€è®¤è¯
- **è¯·æ±‚æ ¼å¼**: `multipart/form-data`
- **å“åº”æ ¼å¼**: `application/json`

## ğŸ“ è¯·æ±‚å‚æ•°

### å¿…å¡«å‚æ•°

| å‚æ•°å | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| `file` | File | è¿è§„æˆªå›¾æ–‡ä»¶ | screenshot.jpg |
| `clientId` | String | å®¢æˆ·ç«¯å”¯ä¸€æ ‡è¯†ç¬¦ | `65ffa6a7-2f4b-4ab2-b0d6-8db48840e520` |
| `violationType` | String | è¿è§„ç±»å‹ | `BLOCKCHAIN_ADDRESS` |
| `violationContent` | String | è¿è§„å†…å®¹ | `1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2` |
| `timestamp` | String | è¿è§„å‘ç”Ÿæ—¶é—´ | `2025-08-22T10:30:00.000Z` |

### å¯é€‰å‚æ•°

| å‚æ•°å | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| `additionalData` | String | é™„åŠ æ•°æ®(JSONæ ¼å¼) | `{"clipboardContent":"å¤åˆ¶çš„å†…å®¹","applicationName":"Chrome"}` |

### å‚æ•°è¯¦ç»†è¯´æ˜

#### violationType æ”¯æŒçš„ç±»å‹
- `BLOCKCHAIN_ADDRESS` - åŒºå—é“¾åœ°å€è¿è§„
- `SENSITIVE_CONTENT` - æ•æ„Ÿå†…å®¹è¿è§„
- `UNAUTHORIZED_ACCESS` - æœªæˆæƒè®¿é—®

#### timestamp æ ¼å¼
- ä½¿ç”¨ ISO 8601 æ ¼å¼
- åŒ…å«æ—¶åŒºä¿¡æ¯
- ç¤ºä¾‹: `2025-08-22T10:30:00.000Z`

#### additionalData ç»“æ„
```json
{
  "clipboardContent": "æ£€æµ‹åˆ°çš„å‰ªè´´æ¿å†…å®¹",
  "applicationName": "è§¦å‘è¿è§„çš„åº”ç”¨ç¨‹åºåç§°",
  "windowTitle": "çª—å£æ ‡é¢˜",
  "processName": "è¿›ç¨‹åç§°",
  "riskLevel": "HIGH|MEDIUM|LOW"
}
```

## ğŸ“¤ è¯·æ±‚ç¤ºä¾‹

### cURL ç¤ºä¾‹

```bash
curl -X POST "http://your-server:3001/api/security/violations/report-with-screenshot" \
  -F "file=@screenshot.jpg" \
  -F "clientId=65ffa6a7-2f4b-4ab2-b0d6-8db48840e520" \
  -F "violationType=BLOCKCHAIN_ADDRESS" \
  -F "violationContent=1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2" \
  -F "timestamp=2025-08-22T10:30:00.000Z" \
  -F "additionalData={\"clipboardContent\":\"å‘ç°æ¯”ç‰¹å¸åœ°å€\",\"applicationName\":\"Chrome\"}"
```

### JavaScript ç¤ºä¾‹

```javascript
const formData = new FormData();
formData.append('file', screenshotFile);
formData.append('clientId', '65ffa6a7-2f4b-4ab2-b0d6-8db48840e520');
formData.append('violationType', 'BLOCKCHAIN_ADDRESS');
formData.append('violationContent', '1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2');
formData.append('timestamp', new Date().toISOString());
formData.append('additionalData', JSON.stringify({
  clipboardContent: 'å‘ç°æ¯”ç‰¹å¸åœ°å€',
  applicationName: 'Chrome'
}));

fetch('http://your-server:3001/api/security/violations/report-with-screenshot', {
  method: 'POST',
  body: formData
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));
```

### Python ç¤ºä¾‹

```python
import requests
import json
from datetime import datetime

url = "http://your-server:3001/api/security/violations/report-with-screenshot"

files = {
    'file': ('screenshot.jpg', open('screenshot.jpg', 'rb'), 'image/jpeg')
}

data = {
    'clientId': '65ffa6a7-2f4b-4ab2-b0d6-8db48840e520',
    'violationType': 'BLOCKCHAIN_ADDRESS',
    'violationContent': '1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2',
    'timestamp': datetime.now().isoformat() + 'Z',
    'additionalData': json.dumps({
        'clipboardContent': 'å‘ç°æ¯”ç‰¹å¸åœ°å€',
        'applicationName': 'Chrome'
    })
}

response = requests.post(url, files=files, data=data)
print(response.json())
```

## ğŸ“¥ å“åº”æ ¼å¼

### æˆåŠŸå“åº”

**HTTPçŠ¶æ€ç **: `201 Created`

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "success": true,
    "message": "è¿è§„äº‹ä»¶ä¸ŠæŠ¥æˆåŠŸ",
    "alertId": 16238,
    "screenshotUrl": "/storage/screenshots/client-id/alerts/screenshot-filename.jpg"
  },
  "success": true,
  "timestamp": "2025-08-22T10:30:00.000Z"
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `code` | Number | ä¸šåŠ¡çŠ¶æ€ç ï¼Œ200è¡¨ç¤ºæˆåŠŸ |
| `message` | String | æ“ä½œç»“æœæè¿° |
| `data.success` | Boolean | æ“ä½œæ˜¯å¦æˆåŠŸ |
| `data.message` | String | è¯¦ç»†æˆåŠŸä¿¡æ¯ |
| `data.alertId` | Number | ç”Ÿæˆçš„å‘Šè­¦è®°å½•ID |
| `data.screenshotUrl` | String | ä¸Šä¼ æˆªå›¾çš„è®¿é—®è·¯å¾„ |
| `success` | Boolean | æ•´ä½“è¯·æ±‚æ˜¯å¦æˆåŠŸ |
| `timestamp` | String | æœåŠ¡å™¨å“åº”æ—¶é—´ |

### é”™è¯¯å“åº”

**HTTPçŠ¶æ€ç **: `400 Bad Request` / `500 Internal Server Error`

```json
{
  "code": 400,
  "message": "è¯·æ±‚å‚æ•°é”™è¯¯",
  "error": "å®¢æˆ·ç«¯IDä¸å­˜åœ¨",
  "success": false,
  "timestamp": "2025-08-22T10:30:00.000Z"
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ–‡ä»¶è¦æ±‚
- **æ”¯æŒæ ¼å¼**: JPG, JPEG, PNG, BMP
- **æ–‡ä»¶å¤§å°**: å»ºè®®ä¸è¶…è¿‡10MB
- **å›¾ç‰‡å°ºå¯¸**: æ— ç‰¹æ®Šé™åˆ¶ï¼Œå»ºè®®ä¸è¶…è¿‡4Kåˆ†è¾¨ç‡

### å®¢æˆ·ç«¯IDè¦æ±‚
- å¿…é¡»æ˜¯æœ‰æ•ˆçš„UUIDæ ¼å¼
- å®¢æˆ·ç«¯å¿…é¡»å·²åœ¨ç³»ç»Ÿä¸­æ³¨å†Œ
- å¦‚å®¢æˆ·ç«¯ä¸å­˜åœ¨ï¼Œæ¥å£å°†è¿”å›é”™è¯¯

### æ—¶é—´æˆ³è¦æ±‚
- å¿…é¡»ä½¿ç”¨ISO 8601æ ¼å¼
- å»ºè®®ä½¿ç”¨UTCæ—¶é—´
- æ—¶é—´ä¸èƒ½è¶…è¿‡å½“å‰æ—¶é—´24å°æ—¶

### ç½‘ç»œè¦æ±‚
- ç¡®ä¿å®¢æˆ·ç«¯èƒ½è®¿é—®æœåŠ¡å™¨åœ°å€
- å»ºè®®ä½¿ç”¨HTTPSåè®®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- è¶…æ—¶æ—¶é—´å»ºè®®è®¾ç½®ä¸º30ç§’ä»¥ä¸Š

## ğŸ” å¸¸è§é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------|
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | æ£€æŸ¥å¿…å¡«å‚æ•°æ˜¯å¦å®Œæ•´ |
| 404 | å®¢æˆ·ç«¯ä¸å­˜åœ¨ | ç¡®è®¤clientIdæ˜¯å¦æ­£ç¡®æ³¨å†Œ |
| 413 | æ–‡ä»¶è¿‡å¤§ | å‹ç¼©å›¾ç‰‡æˆ–é™ä½åˆ†è¾¨ç‡ |
| 415 | ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ | ä½¿ç”¨æ”¯æŒçš„å›¾ç‰‡æ ¼å¼ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | è”ç³»ç³»ç»Ÿç®¡ç†å‘˜ |

## ğŸš€ æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†
```javascript
try {
  const response = await fetch(url, options);
  if (!response.ok) {
    throw new Error(`HTTP error! status: ${response.status}`);
  }
  const result = await response.json();
  if (!result.success) {
    throw new Error(result.message);
  }
  return result.data;
} catch (error) {
  console.error('ä¸ŠæŠ¥å¤±è´¥:', error.message);
  // å®ç°é‡è¯•é€»è¾‘æˆ–æœ¬åœ°ç¼“å­˜
}
```

### 2. é‡è¯•æœºåˆ¶
- ç½‘ç»œé”™è¯¯æ—¶å®ç°æŒ‡æ•°é€€é¿é‡è¯•
- æœ€å¤§é‡è¯•æ¬¡æ•°å»ºè®®ä¸è¶…è¿‡3æ¬¡
- é‡è¯•é—´éš”: 1s, 2s, 4s

### 3. æœ¬åœ°ç¼“å­˜
- ç½‘ç»œä¸å¯ç”¨æ—¶å°†æ•°æ®ç¼“å­˜åˆ°æœ¬åœ°
- ç½‘ç»œæ¢å¤åæ‰¹é‡ä¸ŠæŠ¥ç¼“å­˜çš„è¿è§„äº‹ä»¶
- é¿å…é‡å¤ä¸ŠæŠ¥ç›¸åŒçš„è¿è§„äº‹ä»¶

## ğŸ“‹ é›†æˆæ£€æŸ¥æ¸…å•

### å¼€å‘é˜¶æ®µ
- [ ] ç¡®è®¤æœåŠ¡å™¨åœ°å€å’Œç«¯å£
- [ ] è·å–æœ‰æ•ˆçš„å®¢æˆ·ç«¯ID
- [ ] å®ç°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- [ ] æ·»åŠ é”™è¯¯å¤„ç†é€»è¾‘
- [ ] å®ç°é‡è¯•æœºåˆ¶
- [ ] æ·»åŠ æœ¬åœ°ç¼“å­˜åŠŸèƒ½

### æµ‹è¯•é˜¶æ®µ
- [ ] æµ‹è¯•å„ç§è¿è§„ç±»å‹
- [ ] æµ‹è¯•ä¸åŒæ ¼å¼çš„å›¾ç‰‡æ–‡ä»¶
- [ ] æµ‹è¯•ç½‘ç»œå¼‚å¸¸æƒ…å†µ
- [ ] éªŒè¯é”™è¯¯å¤„ç†æ˜¯å¦æ­£å¸¸
- [ ] æ£€æŸ¥é‡è¯•æœºåˆ¶æ˜¯å¦ç”Ÿæ•ˆ

### ç”Ÿäº§éƒ¨ç½²
- [ ] é…ç½®æ­£ç¡®çš„æœåŠ¡å™¨åœ°å€
- [ ] å¯ç”¨HTTPSåè®®
- [ ] è®¾ç½®åˆé€‚çš„è¶…æ—¶æ—¶é—´
- [ ] é…ç½®æ—¥å¿—è®°å½•
- [ ] ç›‘æ§æ¥å£è°ƒç”¨æƒ…å†µ

## ğŸ”§ SDK ç¤ºä¾‹

### C# ç¤ºä¾‹

```csharp
using System;
using System.IO;
using System.Net.Http;
using System.Text;
using System.Threading.Tasks;
using Newtonsoft.Json;

public class ViolationReporter
{
    private readonly HttpClient _httpClient;
    private readonly string _serverUrl;
    private readonly string _clientId;

    public ViolationReporter(string serverUrl, string clientId)
    {
        _httpClient = new HttpClient();
        _serverUrl = serverUrl;
        _clientId = clientId;
    }

    public async Task<ViolationResponse> ReportViolationAsync(
        byte[] screenshotData,
        string violationType,
        string violationContent,
        object additionalData = null)
    {
        var url = $"{_serverUrl}/api/security/violations/report-with-screenshot";

        using var content = new MultipartFormDataContent();
        content.Add(new ByteArrayContent(screenshotData), "file", "screenshot.jpg");
        content.Add(new StringContent(_clientId), "clientId");
        content.Add(new StringContent(violationType), "violationType");
        content.Add(new StringContent(violationContent), "violationContent");
        content.Add(new StringContent(DateTime.UtcNow.ToString("yyyy-MM-ddTHH:mm:ss.fffZ")), "timestamp");

        if (additionalData != null)
        {
            content.Add(new StringContent(JsonConvert.SerializeObject(additionalData)), "additionalData");
        }

        var response = await _httpClient.PostAsync(url, content);
        var responseContent = await response.Content.ReadAsStringAsync();

        return JsonConvert.DeserializeObject<ViolationResponse>(responseContent);
    }
}

public class ViolationResponse
{
    public int Code { get; set; }
    public string Message { get; set; }
    public ViolationData Data { get; set; }
    public bool Success { get; set; }
    public DateTime Timestamp { get; set; }
}

public class ViolationData
{
    public bool Success { get; set; }
    public string Message { get; set; }
    public int AlertId { get; set; }
    public string ScreenshotUrl { get; set; }
}
```

### Java ç¤ºä¾‹

```java
import okhttp3.*;
import com.google.gson.Gson;
import java.io.File;
import java.time.Instant;
import java.util.HashMap;
import java.util.Map;

public class ViolationReporter {
    private final OkHttpClient client;
    private final String serverUrl;
    private final String clientId;
    private final Gson gson;

    public ViolationReporter(String serverUrl, String clientId) {
        this.client = new OkHttpClient();
        this.serverUrl = serverUrl;
        this.clientId = clientId;
        this.gson = new Gson();
    }

    public ViolationResponse reportViolation(
            File screenshotFile,
            String violationType,
            String violationContent,
            Map<String, Object> additionalData) throws Exception {

        String url = serverUrl + "/api/security/violations/report-with-screenshot";

        MultipartBody.Builder builder = new MultipartBody.Builder()
                .setType(MultipartBody.FORM)
                .addFormDataPart("file", screenshotFile.getName(),
                        RequestBody.create(screenshotFile, MediaType.parse("image/jpeg")))
                .addFormDataPart("clientId", clientId)
                .addFormDataPart("violationType", violationType)
                .addFormDataPart("violationContent", violationContent)
                .addFormDataPart("timestamp", Instant.now().toString());

        if (additionalData != null) {
            builder.addFormDataPart("additionalData", gson.toJson(additionalData));
        }

        Request request = new Request.Builder()
                .url(url)
                .post(builder.build())
                .build();

        try (Response response = client.newCall(request).execute()) {
            String responseBody = response.body().string();
            return gson.fromJson(responseBody, ViolationResponse.class);
        }
    }
}
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼
- **æŠ€æœ¯æ–‡æ¡£**: æŸ¥çœ‹å®Œæ•´APIæ–‡æ¡£
- **é—®é¢˜åé¦ˆ**: é€šè¿‡ç³»ç»Ÿç®¡ç†å‘˜åé¦ˆæŠ€æœ¯é—®é¢˜
- **æ›´æ–°é€šçŸ¥**: å…³æ³¨æ¥å£ç‰ˆæœ¬æ›´æ–°

### å¸¸è§é—®é¢˜FAQ

**Q: å¦‚ä½•è·å–å®¢æˆ·ç«¯IDï¼Ÿ**
A: å®¢æˆ·ç«¯IDéœ€è¦é€šè¿‡ç³»ç»Ÿç®¡ç†å‘˜åˆ†é…ï¼Œæˆ–é€šè¿‡å®¢æˆ·ç«¯æ³¨å†Œæ¥å£è·å–ã€‚

**Q: æ”¯æŒæ‰¹é‡ä¸ŠæŠ¥å—ï¼Ÿ**
A: å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒæ‰¹é‡ä¸ŠæŠ¥ï¼Œéœ€è¦é€ä¸ªè°ƒç”¨æ¥å£ã€‚

**Q: æˆªå›¾æ–‡ä»¶ä¼šä¿å­˜å¤šä¹…ï¼Ÿ**
A: æˆªå›¾æ–‡ä»¶ä¼šæ°¸ä¹…ä¿å­˜åœ¨æœåŠ¡å™¨å­˜å‚¨ä¸­ï¼Œç”¨äºè¿è§„äº‹ä»¶çš„è¯æ®ä¿å­˜ã€‚

**Q: æ¥å£æœ‰è°ƒç”¨é¢‘ç‡é™åˆ¶å—ï¼Ÿ**
A: ç›®å‰æ²¡æœ‰ä¸¥æ ¼çš„é¢‘ç‡é™åˆ¶ï¼Œä½†å»ºè®®åˆç†æ§åˆ¶è°ƒç”¨é¢‘ç‡ï¼Œé¿å…å¯¹æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-08-22
**é€‚ç”¨ç‰ˆæœ¬**: åç«¯ v1.0.0+
