# æˆªå›¾ä¸Šä¼ æ¥å£å¿«é€Ÿå‚è€ƒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœåŠ¡å™¨åœ°å€
```
å¼€å‘ç¯å¢ƒ: http://localhost:3001
ç”Ÿäº§ç¯å¢ƒ: http://your-server:3001
```

## ğŸ“‹ æ ¸å¿ƒæ¥å£

### 1. å®¢æˆ·ç«¯æ³¨å†Œ
```bash
POST /api/clients/register
Content-Type: application/json

{
  "hostname": "CLIENT-NAME",
  "ipAddress": "192.168.1.100",
  "osInfo": "Windows 10",
  "version": "1.0.0"
}

# å“åº”
{
  "success": true,
  "data": {
    "clientId": "uuid-string"
  }
}
```

### 2. å‘é€å¿ƒè·³
```bash
POST /api/clients/heartbeat
Content-Type: application/json

{
  "clientId": "uuid-string",
  "ipAddress": "192.168.1.100",
  "hostname": "CLIENT-NAME",
  "osInfo": "Windows 10",
  "version": "1.0.0"
}
```

### 3. ä¸Šä¼ æ–‡ä»¶
```bash
POST /api/files/upload
Content-Type: multipart/form-data

file: [äºŒè¿›åˆ¶æ–‡ä»¶]

# å“åº”
{
  "success": true,
  "data": {
    "url": "http://minio-url/file.jpg",
    "key": "files/2025/08/22/uuid-file.jpg"
  }
}
```

### 4. æŸ¥è¯¢å®‰å…¨å‘Šè­¦
```bash
GET /api/security/alerts?clientId=uuid&page=1&pageSize=10

# å“åº”
{
  "success": true,
  "data": {
    "alerts": [...],
    "total": 8,
    "page": 1,
    "pageSize": 10
  }
}
```

### 5. æ›´æ–°å‘Šè­¦çŠ¶æ€
```bash
PUT /api/security/alerts/16244/status
Content-Type: application/json

{
  "status": "confirmed",
  "remark": "å·²ç¡®è®¤è¿è§„"
}
```

### 6. æ‰¹é‡å¿½ç•¥å‘Šè­¦
```bash
POST /api/security/alerts/ignore-all
Content-Type: application/json

{
  "clientId": "uuid-string"
}
```

### 7. è¿è§„ä¸ŠæŠ¥ï¼ˆå«æˆªå›¾ï¼‰
```bash
POST /api/security/violations/report-with-screenshot
Content-Type: multipart/form-data

file: [æˆªå›¾æ–‡ä»¶]
clientId: uuid-string
violationType: BLOCKCHAIN_ADDRESS
violationContent: 1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2
timestamp: 2025-08-22T10:30:00.000Z
additionalData: {"clipboardContent":"è¿è§„å†…å®¹"}

# å“åº”
{
  "success": true,
  "alertId": 16239,
  "screenshotUrl": "http://minio-url/violation.jpg"
}
```

## ğŸ”§ Pythonç¤ºä¾‹

### å®Œæ•´å®¢æˆ·ç«¯ç¤ºä¾‹
```python
import requests
import json
import time
from datetime import datetime

class ScreenMonitorClient:
    def __init__(self, server_url="http://localhost:3001"):
        self.server_url = server_url
        self.client_id = None
        
    def register(self):
        """æ³¨å†Œå®¢æˆ·ç«¯"""
        url = f"{self.server_url}/api/clients/register"
        data = {
            "hostname": "PYTHON-CLIENT",
            "ipAddress": "192.168.1.100",
            "osInfo": "Windows 10",
            "version": "1.0.0"
        }
        
        response = requests.post(url, json=data)
        if response.status_code == 201:
            result = response.json()
            self.client_id = result['data']['clientId']
            print(f"æ³¨å†ŒæˆåŠŸ: {self.client_id}")
            return True
        return False
    
    def heartbeat(self):
        """å‘é€å¿ƒè·³"""
        if not self.client_id:
            return False
            
        url = f"{self.server_url}/api/clients/heartbeat"
        data = {
            "clientId": self.client_id,
            "ipAddress": "192.168.1.100",
            "hostname": "PYTHON-CLIENT",
            "osInfo": "Windows 10",
            "version": "1.0.0",
            "metadata": {
                "platform": "Python",
                "timestamp": datetime.now().isoformat()
            }
        }
        
        response = requests.post(url, json=data)
        return response.status_code == 200
    
    def upload_file(self, file_path):
        """ä¸Šä¼ æ–‡ä»¶"""
        url = f"{self.server_url}/api/files/upload"
        
        with open(file_path, 'rb') as f:
            files = {'file': f}
            response = requests.post(url, files=files)
        
        if response.status_code == 201:
            return response.json()['data']
        return None
    
    def report_violation(self, screenshot_path, violation_content):
        """ä¸ŠæŠ¥è¿è§„äº‹ä»¶"""
        if not self.client_id:
            return False
            
        url = f"{self.server_url}/api/security/violations/report-with-screenshot"
        
        data = {
            'clientId': self.client_id,
            'violationType': 'BLOCKCHAIN_ADDRESS',
            'violationContent': violation_content,
            'timestamp': datetime.now().isoformat() + 'Z',
            'additionalData': json.dumps({
                'clipboardContent': f'å‘ç°è¿è§„: {violation_content}',
                'platform': 'Python'
            })
        }
        
        with open(screenshot_path, 'rb') as f:
            files = {'file': f}
            response = requests.post(url, files=files, data=data)
        
        if response.status_code == 201:
            return response.json()
        return None

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    client = ScreenMonitorClient()
    
    # 1. æ³¨å†Œå®¢æˆ·ç«¯
    if client.register():
        print("âœ… å®¢æˆ·ç«¯æ³¨å†ŒæˆåŠŸ")
        
        # 2. å‘é€å¿ƒè·³
        if client.heartbeat():
            print("âœ… å¿ƒè·³å‘é€æˆåŠŸ")
        
        # 3. ä¸Šä¼ æ–‡ä»¶
        file_info = client.upload_file("screenshot.jpg")
        if file_info:
            print(f"âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸ: {file_info['url']}")
        
        # 4. ä¸ŠæŠ¥è¿è§„
        violation_result = client.report_violation(
            "violation.jpg", 
            "1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2"
        )
        if violation_result:
            print(f"âœ… è¿è§„ä¸ŠæŠ¥æˆåŠŸ: å‘Šè­¦ID {violation_result['alertId']}")
```

## ğŸ” å¿«é€Ÿæµ‹è¯•

### ä½¿ç”¨curlæµ‹è¯•æ‰€æœ‰æ¥å£
```bash
#!/bin/bash

SERVER="http://localhost:3001"

# 1. æ³¨å†Œå®¢æˆ·ç«¯
echo "=== æ³¨å†Œå®¢æˆ·ç«¯ ==="
RESPONSE=$(curl -s -X POST $SERVER/api/clients/register \
  -H "Content-Type: application/json" \
  -d '{"hostname":"TEST","ipAddress":"127.0.0.1","osInfo":"Linux","version":"1.0.0"}')

CLIENT_ID=$(echo $RESPONSE | jq -r '.data.clientId')
echo "å®¢æˆ·ç«¯ID: $CLIENT_ID"

# 2. å¿ƒè·³æµ‹è¯•
echo -e "\n=== å¿ƒè·³æµ‹è¯• ==="
curl -X POST $SERVER/api/clients/heartbeat \
  -H "Content-Type: application/json" \
  -d "{\"clientId\":\"$CLIENT_ID\",\"ipAddress\":\"127.0.0.1\"}"

# 3. åˆ›å»ºæµ‹è¯•å›¾ç‰‡å¹¶ä¸Šä¼ 
echo -e "\n=== æ–‡ä»¶ä¸Šä¼ æµ‹è¯• ==="
echo "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==" | base64 -d > test.png
curl -X POST $SERVER/api/files/upload -F "file=@test.png"

# 4. è¿è§„ä¸ŠæŠ¥æµ‹è¯•
echo -e "\n=== è¿è§„ä¸ŠæŠ¥æµ‹è¯• ==="
curl -X POST $SERVER/api/security/violations/report-with-screenshot \
  -F "file=@test.png" \
  -F "clientId=$CLIENT_ID" \
  -F "violationType=BLOCKCHAIN_ADDRESS" \
  -F "violationContent=1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2" \
  -F "timestamp=$(date -u +%Y-%m-%dT%H:%M:%S.000Z)" \
  -F "additionalData={\"test\":true}"

# æ¸…ç†
rm -f test.png
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ–‡ä»¶è¦æ±‚
- **æ ¼å¼**: JPG, PNG
- **å¤§å°**: â‰¤ 2MB
- **åˆ†è¾¨ç‡**: å»ºè®® â‰¤ 2560px

### å¿…å¡«å‚æ•°
- **clientId**: å¿…é¡»å…ˆæ³¨å†Œè·å–
- **timestamp**: ISO 8601æ ¼å¼
- **violationType**: å½“å‰æ”¯æŒ `BLOCKCHAIN_ADDRESS`

### é”™è¯¯å¤„ç†
- **400**: å‚æ•°é”™è¯¯
- **404**: å®¢æˆ·ç«¯ä¸å­˜åœ¨
- **413**: æ–‡ä»¶è¿‡å¤§
- **500**: æœåŠ¡å™¨é”™è¯¯

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´æ¥å£æ–‡æ¡£](./å±å¹•ç›‘æ§æˆªå›¾ä¸Šä¼ æ¥å£æ–‡æ¡£.md)
- [Pythonå®¢æˆ·ç«¯æ–‡æ¡£](./clients/python/README.md)
- [APIåœ¨çº¿æ–‡æ¡£](http://localhost:3001/api-docs)

---
**å¿«é€Ÿå‚è€ƒç‰ˆæœ¬**: v1.0 | **æ›´æ–°**: 2025-08-22
