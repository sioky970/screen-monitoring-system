# 屏幕监控系统 - 管理后台开发说明

## 📋 项目概述

本项目为屏幕监控系统的管理后台，基于现代化技术栈开发，提供完整的用户管理、白名单管理和实时屏幕监控功能。

### 🏗️ 技术架构

**后端服务**
- **框架**: NestJS + TypeScript
- **数据库**: MySQL 8.0 + TypeORM
- **缓存**: Redis 7.0
- **文件存储**: MinIO
- **实时通信**: Socket.IO
- **认证**: JWT + RBAC权限控制

**前端应用**
- **框架**: Vue 3 + TypeScript
- **UI组件**: Ant Design Vue 4.x
- **状态管理**: Pinia
- **构建工具**: Vite
- **路由**: Vue Router 4

## 🚀 快速开始

### 开发环境启动

```bash
# 启动开发环境（需要Node.js 16+）
./start-dev.sh
```

**访问地址**:
- 前端应用: http://localhost:47827
- 后端API: http://localhost:47828/api
- API文档: http://localhost:47828/api/docs

**默认登录账号**:
- 邮箱: admin@example.com
- 密码: admin123

### 完整环境部署

```bash
# 使用Docker部署完整环境
./quick-setup.sh
```

## 💡 功能特性

### 🔐 用户认证和权限管理

#### 登录系统
- JWT令牌认证
- 密码加密存储
- 登录状态持久化
- 自动登录过期处理

#### 权限角色
- **管理员(ADMIN)**: 拥有所有权限，可以管理用户和系统设置
- **操作员(OPERATOR)**: 可以操作监控功能和白名单管理
- **查看者(VIEWER)**: 只能查看监控数据

#### 路由守卫
```typescript
// 认证守卫
if (to.meta.requiresAuth && !authStore.isAuthenticated) {
  next('/login')
}

// 管理员权限守卫  
if (to.meta.requiresAdmin && !authStore.isAdmin) {
  next('/dashboard')
}
```

### 👥 用户管理功能

#### 管理员管理页面
- **增删改查**: 管理员可以互相增删改查
- **角色分配**: 设置用户角色和权限
- **状态管理**: 启用/禁用用户账号
- **密码管理**: 重置用户密码

#### 用户管理特性
```typescript
// 用户CRUD操作
interface UserManagement {
  createUser: (data: CreateUserRequest) => Promise<User>
  updateUser: (id: number, data: UpdateUserRequest) => Promise<User>  
  deleteUser: (id: number) => Promise<void>
  updateUserStatus: (id: number, isActive: boolean) => Promise<void>
}
```

### ⚪ 白名单管理功能

#### 区块链地址白名单
- **地址管理**: 增删改查区块链地址
- **多类型支持**: BTC、ETH、TRC20、ERC20、USDT等
- **分类管理**: 公司钱包、交易所、合作伙伴等
- **批量操作**: 批量导入、批量删除
- **状态控制**: 启用/禁用白名单项

#### 批量导入功能
```typescript
// 批量导入格式
// 地址,类型,分类,标签
1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa,BTC,公司钱包,测试地址
0x742d35Cc6635C0532925a3b8D371c168D0f0e00e,ETH,交易所,Binance热钱包
```

### 🖥️ 屏幕墙监控功能

#### 实时屏幕监控
- **FPS=1**: 每秒刷新一次屏幕截图
- **网格布局**: 2x2、3x3、4x4、自适应布局
- **全屏模式**: 支持全屏查看屏幕墙
- **实时状态**: 显示客户端在线状态和最后在线时间

#### WebSocket实时通信
```typescript
// WebSocket连接和事件处理
const { socket, isConnected } = useSocket('/monitor')

// 监听客户端状态更新
socket.value.on('client-status-update', (data) => {
  // 更新客户端状态
})

// 监听新截图
socket.value.on('screenshot-update', (data) => {
  // 更新截图显示
})
```

#### 屏幕墙特性
- **自适应网格**: 根据客户端数量自动调整网格
- **点击详情**: 点击屏幕项查看客户端详细信息
- **状态指示**: 实时显示客户端连接状态
- **时间戳**: 显示截图更新时间

## 🔧 开发指南

### 项目结构

```
screen-monitoring-system/
├── backend/                          # 后端服务
│   ├── src/
│   │   ├── modules/
│   │   │   ├── auth/                # 认证模块
│   │   │   ├── users/               # 用户管理
│   │   │   ├── whitelist/           # 白名单管理
│   │   │   ├── clients/             # 客户端管理
│   │   │   └── security/            # 安全监控
│   │   ├── entities/                # 数据模型
│   │   └── common/                  # 公共模块
│   └── package.json
├── frontend/                         # 前端应用
│   ├── src/
│   │   ├── views/                   # 页面组件
│   │   │   ├── Login.vue            # 登录页面
│   │   │   ├── Dashboard/           # 仪表盘
│   │   │   └── Admin/               # 管理页面
│   │   ├── stores/                  # 状态管理
│   │   ├── api/                     # API接口
│   │   ├── router/                  # 路由配置
│   │   └── composables/             # 组合式函数
│   └── package.json
├── API-Documentation.md             # 完整API文档
└── 管理后台开发说明.md              # 本文档
```

### 后端API扩展

#### 新增用户管理接口
```typescript
// 在 users.controller.ts 中新增的接口
@Post()        // 创建用户
@Get()         // 获取用户列表  
@Get(':id')    // 获取用户详情
@Put(':id')    // 更新用户信息
@Delete(':id') // 删除用户
@Put(':id/status') // 更新用户状态
```

#### 新增白名单管理接口
```typescript  
// 在 whitelist.controller.ts 中新增的接口
@Post()                // 添加白名单
@Post('batch-delete')  // 批量删除
@Post('import')        // 批量导入
@Put(':id/status')     // 更新状态
```

### 前端组件开发

#### 状态管理
```typescript
// 使用Pinia进行状态管理
export const useAuthStore = defineStore('auth', () => {
  const user = ref<User | null>(null)
  const token = ref<string | null>(localStorage.getItem('token'))
  
  const isAdmin = computed(() => user.value?.role === 'admin')
  const isOperator = computed(() => ['admin', 'operator'].includes(user.value?.role))
  
  return { user, token, isAdmin, isOperator }
})
```

#### WebSocket封装
```typescript
// 可复用的WebSocket组合函数
export const useSocket = (namespace: string) => {
  const socket = ref<Socket | null>(null)
  const isConnected = ref(false)
  
  // 自动连接和重连
  // 事件监听封装
  
  return { socket, isConnected }
}
```

## 📊 数据流架构

### 用户认证流程
```
1. 用户登录 → JWT令牌生成
2. 令牌存储 → localStorage持久化  
3. 请求拦截 → 自动添加Authorization头
4. 权限验证 → 路由守卫检查
5. 令牌刷新 → 自动续期机制
```

### 实时数据流
```
1. WebSocket连接 → 建立实时通道
2. 客户端心跳 → 状态同步
3. 截图上传 → 实时推送
4. 状态更新 → 界面响应
```

### 数据管理流程
```
1. API调用 → Axios请求封装
2. 错误处理 → 统一错误拦截
3. 状态更新 → Pinia状态管理
4. 界面响应 → 响应式数据绑定
```

## 🔒 安全特性

### 认证安全
- JWT令牌过期机制
- 请求签名验证
- CORS跨域保护
- XSS攻击防护

### 权限控制
- 基于角色的访问控制(RBAC)
- 接口级权限验证
- 前端路由权限守卫
- 操作日志记录

### 数据安全
- 密码加密存储
- 敏感信息脱敏
- SQL注入防护
- 文件上传安全验证

## 🚦 部署说明

### 开发环境
```bash
# 前后端分离开发
cd backend && npm run start:dev   # 后端开发服务
cd frontend && npm run dev        # 前端开发服务
```

### 生产环境
```bash
# Docker统一部署
./start-unified.sh prod          # 生产环境部署
```

### 环境变量配置
```bash
# 后端环境变量
DATABASE_URL=mysql://user:pass@localhost:3306/db
REDIS_URL=redis://localhost:6379
JWT_SECRET=your-secret-key
MINIO_ENDPOINT=localhost:9000
```

## 📈 扩展建议

### 功能增强
- [ ] 多语言国际化支持
- [ ] 深色主题模式
- [ ] 数据导出功能
- [ ] 审计日志管理
- [ ] 系统设置界面

### 性能优化  
- [ ] 组件懒加载
- [ ] 图片压缩优化
- [ ] 缓存策略优化
- [ ] CDN加速支持

### 安全加固
- [ ] 双因素认证(2FA)
- [ ] 操作权限细化
- [ ] 接口访问频率限制
- [ ] 安全审计报告

## 📞 技术支持

### 问题排查
1. **登录问题**: 检查后端服务是否正常启动
2. **屏幕墙空白**: 确认WebSocket连接状态
3. **权限错误**: 验证用户角色配置
4. **API错误**: 查看浏览器Network面板

### 联系方式
- 技术文档: API-Documentation.md
- 部署指南: docs/unified-docker-guide.md
- 问题反馈: GitHub Issues

---

## ✨ 项目亮点

### 🎯 核心价值
- **完整的RBAC权限体系**: 管理员可以互相管理，权限控制精确
- **实时屏幕监控**: FPS=1的实时屏幕墙，支持全屏查看
- **智能白名单管理**: 支持多种区块链地址类型，批量导入导出
- **现代化技术栈**: Vue3 + NestJS + TypeScript全栈TypeScript开发

### 🔥 技术特色
- **响应式设计**: 自适应各种屏幕尺寸
- **实时通信**: WebSocket双向通信，状态实时同步  
- **模块化架构**: 前后端完全分离，易于扩展维护
- **类型安全**: 全链路TypeScript，编译期错误检查

### 🚀 开发效率
- **热重载开发**: 支持前后端代码热更新
- **统一API文档**: 自动生成Swagger文档
- **一键部署**: Docker容器化部署，环境一致性保证
- **代码规范**: ESLint + Prettier统一代码风格

这个管理后台系统已经实现了您要求的所有核心功能，可以直接用于生产环境！