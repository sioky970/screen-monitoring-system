# 剪贴板自动清空功能说明

## 功能概述

剪贴板自动清空功能是屏幕监控系统的一个重要安全特性，当检测到用户复制了违规的区块链地址到剪贴板时，系统会自动清空剪贴板内容，防止敏感信息的传播。

## 功能特点

### 🔍 智能检测
- **实时监控**：每0.5秒检查一次剪贴板内容变化
- **多币种支持**：支持检测Bitcoin、Ethereum、Tron、Litecoin、Dogecoin等主流区块链地址
- **精确匹配**：使用正则表达式精确识别各种格式的区块链地址

### 🛡️ 安全防护
- **自动清空**：检测到违规地址后立即清空剪贴板
- **白名单验证**：支持白名单机制，允许特定地址通过
- **违规上报**：自动记录和上报违规事件，包含截图证据

### ⚙️ 灵活配置
- **开关控制**：可通过配置文件启用/禁用自动清空功能
- **参数调整**：可自定义检测间隔、内容长度限制等参数
- **跨平台支持**：支持Windows、Linux、macOS等操作系统

## 配置说明

### 配置文件位置
```
config/config.yaml
```

### 相关配置项
```yaml
# 剪贴板监控配置
clipboard:
  # 检测间隔（秒）
  check_interval: 0.5
  # 是否启用剪贴板监控
  enabled: true
  # 最大内容长度
  max_content_length: 10000
  # 检测到违规地址时是否自动清空剪贴板
  auto_clear_on_violation: true
```

### 配置参数说明

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `check_interval` | float | 0.5 | 剪贴板检测间隔（秒） |
| `enabled` | boolean | true | 是否启用剪贴板监控 |
| `max_content_length` | int | 10000 | 剪贴板内容最大长度限制 |
| `auto_clear_on_violation` | boolean | true | 检测到违规时是否自动清空 |

## 支持的区块链地址类型

### Bitcoin (BTC)
- **Legacy地址**：以1或3开头，25-34位字符
- **Bech32地址**：以bc1开头，39-59位字符
- **示例**：`1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa`

### Ethereum (ETH)
- **格式**：以0x开头，42位十六进制字符
- **示例**：`0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b`

### Tron (TRX)
- **格式**：以T开头，34位字符
- **示例**：`TLa2f6VPqDgRE67v1736s7bJ8Ray5wYjU7`

### Litecoin (LTC)
- **格式**：以L或M或3开头，26-33位字符
- **示例**：`LdP8Qox1VAhCzLJNqrr74YovaWYyNBUWvL`

### Dogecoin (DOGE)
- **格式**：以D开头，34位字符
- **示例**：`DH5yaieqoZN36fDVciNyRueRGvGLR3mr7L`

## 工作流程

### 1. 监控阶段
```
剪贴板内容变化 → 获取新内容 → 长度检查 → 区块链地址检测
```

### 2. 检测阶段
```
正则表达式匹配 → 提取地址信息 → 记录检测统计
```

### 3. 验证阶段
```
白名单检查 → 判断是否违规 → 决定处理方式
```

### 4. 处理阶段
```
违规地址 → 自动清空剪贴板 → 捕获截图 → 上报违规事件
```

## 日志示例

### 正常检测日志
```
2025-08-19 01:17:29 | INFO | 检测到 1 个区块链地址
2025-08-19 01:17:29 | INFO | 检测到tron地址: TLa2f6VPqDgRE67v1736s7bJ8Ray5wYjU7
```

### 自动清空日志
```
2025-08-19 01:17:29 | WARNING | 检测到违规地址，已自动清空剪贴板内容
```

### 功能禁用日志
```
2025-08-19 01:17:29 | WARNING | 检测到违规地址，但自动清空功能已禁用
```

## 使用建议

### 🔧 配置建议
1. **生产环境**：建议启用自动清空功能（`auto_clear_on_violation: true`）
2. **测试环境**：可以禁用自动清空功能以便测试（`auto_clear_on_violation: false`）
3. **检测间隔**：默认0.5秒适合大多数场景，可根据性能需求调整

### 🛠️ 故障排除
1. **剪贴板无法访问**：确保系统安装了剪贴板支持库（如Linux下的xclip）
2. **检测不准确**：检查区块链地址格式是否符合正则表达式规则
3. **清空失败**：检查系统权限和剪贴板访问权限

### 📋 白名单管理
- 通过管理后台添加可信的区块链地址到白名单
- 白名单中的地址不会触发自动清空功能
- 定期审核和更新白名单内容

## 技术实现

### 核心模块
- **ClipboardMonitor**：剪贴板监控主类
- **区块链检测**：正则表达式匹配引擎
- **白名单验证**：地址白名单检查机制
- **违规上报**：事件记录和上报系统

### 依赖库
- **Windows**：`win32clipboard` - Windows剪贴板API
- **跨平台**：`pyperclip` - 跨平台剪贴板库
- **图像处理**：`PIL`、`ImageGrab` - 截图和图像处理
- **图像优化**：`mozjpeg_lossless_optimization` - 图像压缩优化

## 安全说明

⚠️ **重要提醒**：
- 此功能会监控用户的剪贴板内容，请确保符合相关法律法规
- 建议在部署前告知用户此功能的存在和用途
- 违规事件记录包含敏感信息，请妥善保管相关数据
- 定期审查和更新区块链地址检测规则

## 更新日志

### v1.0.0 (2025-08-19)
- ✅ 实现剪贴板自动清空功能
- ✅ 支持多种区块链地址检测
- ✅ 添加配置开关控制
- ✅ 集成白名单验证机制
- ✅ 完善错误处理和日志记录