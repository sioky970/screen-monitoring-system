# å±å¹•ç›‘æ§ç³»ç»Ÿåç«¯ API æ¥å£æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†å±å¹•ç›‘æ§ç³»ç»Ÿåç«¯çš„æ‰€æœ‰APIæ¥å£ã€‚ç³»ç»ŸåŸºäºNestJSæ„å»ºï¼Œæä¾›å®Œæ•´çš„å®¢æˆ·ç«¯ç›‘æ§ã€å®‰å…¨å‘Šè­¦ã€ç”¨æˆ·è®¤è¯ç­‰åŠŸèƒ½ã€‚

- **åŸºç¡€URL**: `http://localhost:3003/api`
- **APIæ–‡æ¡£**: `http://localhost:3003/api/docs`
- **å¥åº·æ£€æŸ¥**: `http://localhost:3003/health`
- **è®¤è¯æ–¹å¼**: JWT Bearer Token
- **å®æ—¶é€šä¿¡**: å·²ç§»é™¤WebSocketï¼Œæ”¹ä¸ºHTTPè½®è¯¢æœºåˆ¶

---

## ğŸ”’ è®¤è¯ç®¡ç† (auth)

### ç®¡ç†å‘˜è®¤è¯

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/auth/login` | ç®¡ç†å‘˜ç™»å½• | æ—  |
| POST | `/auth/logout` | é€€å‡ºç™»å½• | æ—  |
| GET | `/auth/profile` | è·å–ç”¨æˆ·ä¿¡æ¯ | JWT |
| POST | `/auth/change-password` | ä¿®æ”¹å¯†ç  | æ—  |

### å®¢æˆ·ç«¯è®¤è¯

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/auth/client` | å®¢æˆ·ç«¯è®¤è¯ | æ—  |

---

## ğŸ’» å®¢æˆ·ç«¯ç®¡ç† (clients)

### å®¢æˆ·ç«¯åŸºç¡€ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/clients` | è·å–å®¢æˆ·ç«¯åˆ—è¡¨ | æ—  |
| GET | `/clients/stats` | è·å–å®¢æˆ·ç«¯ç»Ÿè®¡ä¿¡æ¯ | æ—  |
| POST | `/clients/heartbeat` | å®¢æˆ·ç«¯å¿ƒè·³ | æ—  |
| POST | `/clients` | åˆ›å»ºå®¢æˆ·ç«¯ | æ—  |
| POST | `/clients/bulk-delete` | æ‰¹é‡åˆ é™¤å®¢æˆ·ç«¯ | æ—  |
| GET | `/clients/:id` | è·å–å®¢æˆ·ç«¯è¯¦æƒ… | æ—  |
| GET | `/clients/:id/detail` | è·å–å®¢æˆ·ç«¯å®Œæ•´è¯¦æƒ…ä¿¡æ¯ | æ—  |
| PUT | `/clients/:id` | æ›´æ–°å®¢æˆ·ç«¯ä¿¡æ¯ | æ—  |
| DELETE | `/clients/:id` | åˆ é™¤å®¢æˆ·ç«¯ | æ—  |
| GET | `/clients/:id/online-logs` | è·å–å®¢æˆ·ç«¯ä¸Šä¸‹çº¿æ—¥å¿— | æ—  |

### å®¢æˆ·ç«¯åˆ†ç»„ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/clients/groups/list` | è·å–å®¢æˆ·ç«¯åˆ†ç»„åˆ—è¡¨ | æ—  |
| POST | `/clients/groups` | åˆ›å»ºå®¢æˆ·ç«¯åˆ†ç»„ | æ—  |
| GET | `/clients/groups/:id` | è·å–å®¢æˆ·ç«¯åˆ†ç»„è¯¦æƒ… | æ—  |
| PUT | `/clients/groups/:id` | æ›´æ–°å®¢æˆ·ç«¯åˆ†ç»„ | æ—  |
| DELETE | `/clients/groups/:id` | åˆ é™¤å®¢æˆ·ç«¯åˆ†ç»„ | æ—  |

---

## âš™ï¸ å®¢æˆ·ç«¯é…ç½®ç®¡ç† (client-config)

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/client-config` | åˆ›å»ºå®¢æˆ·ç«¯é…ç½® | æ—  |
| GET | `/client-config` | æŸ¥è¯¢å®¢æˆ·ç«¯é…ç½®åˆ—è¡¨ | æ—  |
| GET | `/client-config/client/:clientId` | è·å–æŒ‡å®šå®¢æˆ·ç«¯çš„é…ç½® | æ—  |
| GET | `/client-config/client/:clientId/effective` | è·å–å®¢æˆ·ç«¯æœ‰æ•ˆé…ç½® | æ—  |
| PUT | `/client-config/:id` | æ›´æ–°å®¢æˆ·ç«¯é…ç½® | æ—  |
| PUT | `/client-config/batch` | æ‰¹é‡æ›´æ–°å®¢æˆ·ç«¯é…ç½® | æ—  |
| DELETE | `/client-config/:id` | åˆ é™¤å®¢æˆ·ç«¯é…ç½® | æ—  |
| GET | `/client-config/default` | è·å–é»˜è®¤é…ç½® | æ—  |
| POST | `/client-config/client/:clientId/reset` | é‡ç½®å®¢æˆ·ç«¯é…ç½®ä¸ºé»˜è®¤å€¼ | æ—  |

---

## ğŸ›¡ï¸ å®‰å…¨ç›‘æ§ (security)

### å®‰å…¨å‘Šè­¦ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/security/alerts` | è·å–å®‰å…¨å‘Šè­¦åˆ—è¡¨ | æ—  |
| GET | `/security/stats` | è·å–å®‰å…¨ç»Ÿè®¡ä¿¡æ¯ | æ—  |
| POST | `/security/alerts` | åˆ›å»ºå®‰å…¨å‘Šè­¦ | JWT |
| GET | `/security/alerts/:id` | è·å–å®‰å…¨å‘Šè­¦è¯¦æƒ… | æ—  |
| PUT | `/security/alerts/:id/status` | æ›´æ–°å‘Šè­¦çŠ¶æ€ | æ—  |
| DELETE | `/security/alerts/:id` | åˆ é™¤å®‰å…¨å‘Šè­¦ | æ—  |
| PUT | `/security/alerts/ignore-all/:clientId` | å¿½ç•¥æŒ‡å®šå®¢æˆ·ç«¯çš„å…¨éƒ¨æœªå¤„ç†è¿è§„ | æ—  |
| POST | `/security/alerts/ignore-all` | å¿½ç•¥æŒ‡å®šå®¢æˆ·ç«¯çš„å…¨éƒ¨æœªå¤„ç†è¿è§„ï¼ˆPOSTç‰ˆæœ¬ï¼‰ | æ—  |

### æˆªå›¾ä¸Šä¼ å’Œå¤„ç†

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/security/screenshots/upload` | ä¸Šä¼ æˆªå›¾ | æ—  |
| POST | `/security/screenshots/process` | å¤„ç†æˆªå›¾å†…å®¹æ£€æµ‹ | æ—  |
| GET | `/security/screenshots/:clientId/current` | è·å–å®¢æˆ·ç«¯å½“å‰æˆªå›¾URL | æ—  |
| GET | `/security/screenshots/:clientId/alerts` | è·å–å®¢æˆ·ç«¯å‘Šè­¦æˆªå›¾å†å² | æ—  |

### å®¢æˆ·ç«¯è¿è§„ä¸ŠæŠ¥

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/security/violations/report` | å®¢æˆ·ç«¯ä¸ŠæŠ¥è¿è§„äº‹ä»¶ | æ—  |

### æˆªå›¾ä¸Šä¼  + å¿ƒè·³åˆå¹¶æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/security/screenshots/upload-with-heartbeat` | ä¸Šä¼ æˆªå›¾å¹¶å‘é€å¿ƒè·³ | æ—  |

---

## ğŸ“ æ–‡ä»¶ç®¡ç† (files)

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/files/upload` | ä¸Šä¼ æ–‡ä»¶ | JWT |
| GET | `/files/:key/url` | è·å–æ–‡ä»¶è®¿é—®URL | æ—  |
| DELETE | `/files/:key` | åˆ é™¤æ–‡ä»¶ | JWT |

---

## ğŸ“¢ é€šçŸ¥ç®¡ç† (notifications)

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/notifications` | è·å–é€šçŸ¥åˆ—è¡¨ | JWT |
| GET | `/notifications/:id` | è·å–é€šçŸ¥è¯¦æƒ… | JWT |

---

## ğŸ“ˆ ç³»ç»Ÿç®¡ç† (system)

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/system/logs` | è·å–ç³»ç»Ÿæ—¥å¿— | JWT |
| GET | `/system/database/status` | è·å–æ•°æ®åº“çŠ¶æ€ | æ—  |

---

## âœ… ç™½åå•ç®¡ç† (whitelist)

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/whitelist` | è·å–ç™½åå•åˆ—è¡¨ | æ—  |
| GET | `/whitelist/stats` | è·å–ç™½åå•ç»Ÿè®¡ä¿¡æ¯ | æ—  |
| POST | `/whitelist` | æ·»åŠ ç™½åå•åœ°å€ | æ—  |
| GET | `/whitelist/:id` | è·å–ç™½åå•è¯¦æƒ… | æ—  |
| PUT | `/whitelist/:id` | æ›´æ–°ç™½åå•ä¿¡æ¯ | æ—  |
| PUT | `/whitelist/:id/status` | æ›´æ–°ç™½åå•çŠ¶æ€ | æ—  |
| DELETE | `/whitelist/:id` | åˆ é™¤ç™½åå•åœ°å€ | æ—  |
| POST | `/whitelist/batch-delete` | æ‰¹é‡åˆ é™¤ç™½åå• | æ—  |
| POST | `/whitelist/import` | æ‰¹é‡å¯¼å…¥ç™½åå• | æ—  |
| GET | `/whitelist/addresses/active` | è·å–æ‰€æœ‰æ¿€æ´»çš„ç™½åå•åœ°å€ | æ—  |

---

## ğŸŒ å…¨å±€è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/health` | å¥åº·æ£€æŸ¥ | æ—  |
| GET | `/api/docs` | APIæ–‡æ¡£ | æ—  |
| GET | `/api/docs-json` | APIæ–‡æ¡£JSON | æ—  |

---

## ğŸ“¡ WebSocket äº‹ä»¶

### è¿æ¥ä¿¡æ¯
- **URL**: `ws://localhost:3005/monitor`
- **å‘½åç©ºé—´**: `/monitor`

### æ”¯æŒçš„äº‹ä»¶
- å®¢æˆ·ç«¯çŠ¶æ€å˜æ›´é€šçŸ¥
- å®‰å…¨å‘Šè­¦å®æ—¶æ¨é€
- ç³»ç»ŸçŠ¶æ€æ›´æ–°
- å®æ—¶ç›‘æ§æ•°æ®

---

## ğŸ” è®¤è¯è¯´æ˜

### JWTè®¤è¯
- **Header**: `Authorization: Bearer <token>`
- **è·å–æ–¹å¼**: é€šè¿‡ `/auth/login` æ¥å£è·å–
- **æœ‰æ•ˆæœŸ**: æ ¹æ®ç³»ç»Ÿé…ç½®

### å…¬å¼€æ¥å£
å¤§éƒ¨åˆ†æ¥å£æ ‡è®°ä¸º `@Public()`ï¼Œæ— éœ€è®¤è¯å³å¯è®¿é—®ã€‚è¿™æ˜¯ä¸ºäº†æ–¹ä¾¿å®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨ã€‚

---

## ğŸ“Š å“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {},
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

### é”™è¯¯å“åº”
```json
{
  "code": 400,
  "message": "è¯·æ±‚å‚æ•°é”™è¯¯",
  "error": "è¯¦ç»†é”™è¯¯ä¿¡æ¯",
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. **å¯åŠ¨æœåŠ¡**
   ```bash
   npm run start:dev
   ```

2. **è®¿é—®APIæ–‡æ¡£**
   ```
   http://localhost:3003/api/docs
   ```

3. **å¥åº·æ£€æŸ¥**
   ```bash
   curl http://localhost:3003/health
   ```

4. **ç®¡ç†å‘˜ç™»å½•**
   ```bash
   curl -X POST http://localhost:3003/api/auth/login \
     -H "Content-Type: application/json" \
     -d '{"email":"admin@example.com","password":"password"}'
   ```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶ä¸Šä¼ é™åˆ¶**: æˆªå›¾æ–‡ä»¶æœ€å¤§10MB
2. **é¢‘ç‡é™åˆ¶**: æˆªå›¾ä¸Šä¼ æ¯åˆ†é’Ÿæœ€å¤š30æ¬¡ï¼Œè¿è§„ä¸ŠæŠ¥æ¯åˆ†é’Ÿæœ€å¤š10æ¬¡
3. **æ–‡ä»¶ç±»å‹**: åªå…è®¸ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶
4. **æ•°æ®åº“**: æ”¯æŒMySQLå’ŒSQLite
5. **å­˜å‚¨**: ä½¿ç”¨MinIOå¯¹è±¡å­˜å‚¨
6. **ç¼“å­˜**: ä½¿ç”¨Redisç¼“å­˜

---

## ğŸ”§ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: NestJS + TypeScript
- **æ•°æ®åº“**: MySQL 8.0 + TypeORM
- **ç¼“å­˜**: Redis 7.0
- **å­˜å‚¨**: MinIO å¯¹è±¡å­˜å‚¨
- **å®æ—¶é€šä¿¡**: Socket.IO WebSocket
- **è®¤è¯**: JWT Bearer Token
- **æ–‡æ¡£**: Swagger/OpenAPI
- **å®‰å…¨**: Helmet + CORS
- **å‹ç¼©**: Compression

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2024-12-19*
*APIç‰ˆæœ¬: v1.0.0*